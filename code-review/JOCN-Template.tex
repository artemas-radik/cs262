\documentclass[9pt,twocolumn,twoside]{osajnl}
\usepackage{hyperref}
\journal{jocn} 
\usepackage{xcolor}
\usepackage{listings}
\lstset{
  basicstyle=\fontfamily{lmvtt}\selectfont\small\color{blue},
  columns=fullflexible,
}


% Set the article type for journal submissions. Comment out this line for Optica Open preprint submissions.
\setboolean{shortarticle}{true}
% true = letter / tutorial
% false = research / review article

\title{ Demo Day 1 Code Review: Aayush Karan \& Michael Hla }

\author[1]{Artemas Radik}
\author[2]{Swati Goel}

\affil[1]{Harvard College, A.B./S.M. Computer Science \& Statistcs, artemas@college.harvard.edu}
\affil[2]{Harvard College, A.B. Computer Science \& Physics, sgoel@college.harvard.edu}

%% To be edited by editor
% \dates{Compiled \today}

%% To be edited by editor
% \doi{\url{http://dx.doi.org/10.1364/XX.XX.XXXXXX}}

\begin{abstract}
JOCN article style and format is being updated to conform to Optica journal style and format. This new template is now required for preparing a research article for submission to the \emph{Journal of Optical Communications and Networking}. Consult the \href{https://www.opg.optica.org/submit/templates/}{Author Style Guide} for general information about manuscript preparation. Authors may also \href{https://opticaopen.org}{submit articles} prepared using this template to the Optica Publishing Group preprint server, \href{https://preprints.opticaopen.org}{Optica Open}. However, doing so is optional. Please refer to the submission guidelines found there. Note that copyright and licensing information should no longer be added to your Journal or Optica Open manuscript.
\end{abstract}

\setboolean{displaycopyright}{false} % Do not include copyright or licensing information in submission.

\begin{document}

\maketitle
\section{Introduction}
This code review was conducted on commit \texttt{573fc69} of the repository submitted to us by Aayush and Michael, available \href{https://github.com/akaran1729/CS_262_Wire_Protocol}{publicly on GitHub}. Aayush and Michael are reachable via email at \texttt{karan@college.harvard.edu} and \texttt{michaelhla@college.harvard.edu}, respectively. The code review aims to answer the following questions with regards to the submission:

\begin{enumerate}
  \item Does it function as specified?
  \item Is the code rational, correct, and clear?
  \item Is the code and installation documentation adequate?
\end{enumerate}

\section{Functionality}

We tested both the gRPC and non-GRPC versions of the program for the following functionaity.
\begin{enumerate}
  \item Creating an account with a unique username.
  \item List all accounts or a subset of the accounts by text wildcard.
  \item Send a message to a recipient. If the recipient is logged in, deliver immediately; otherwise queue the message and deliver on demand. If the message is sent to someone who isn't a user, return an error message.
  \item Deliver undelivered messages to a particular user.
  \item Delete an account. You will need to specify the semantics of what happens if you attempt to delete an account that contains undelivered message.
\end{enumerate}

\medskip

\noindent \textbf{Testing}

\medskip

\noindent We began by following the provided installation instructions in the engineering notebook, starting the non-gRPC server via \texttt{python3 socket\_server.py 10.250.113.127 5000}. Our first test involved creating an account with the client as seen below.

\begin{lstlisting}[caption={Account Creation Test}]
python3 socket_client.py 10.250.113.127 5000
Welcome to Messenger! Please login or create an account:
Create Account
a
Account created. Welcome a!
\end{lstlisting}

\noindent We wanted to ensure that unique usernames were enforced, so we spawned another client and tried to create another account with the existing username.

\begin{lstlisting}[caption={Unique Username Test}]
python3 socket_client.py 10.250.113.127 5000
Welcome to Messenger! Please login or create an account:
Create Account
a
The account a already exists. Please try again.
\end{lstlisting}

\noindent We were satisfied with these two tests as evidence of account functionaity, so we began testing the username listing feature. As a prerequisite, we created additional accounts with usernames \texttt{blueberry}, \texttt{cranberry} and \texttt{elderberry}. Per the engineering notebook, the username listing feature follows Python RegEx. Thus we began by listing usernames following the \texttt{.*} expression, which we expected to return all usernames. We then listed usernamed following the \texttt{\textasciicircum.*berry.*\$} expression, expecting the last three usernames. We were highly impressed with the RegEx matching functionaity.

\begin{lstlisting}[caption={Account List and Filter Test}]
python3 socket_client.py 10.250.113.127 5000
Welcome to Messenger! Please login or create an account:
List Accounts
.*
Users matching .*:
a blueberry cranberry elderberry 
List Accounts
^.*berry.*$
Users matching ^.*berry.*$:
blueberry cranberry elderberry
\end{lstlisting}

\noindent The next test involved sending a message from the logged in \texttt{blueberry} client to the logged in \texttt{cranberry} client.

\begin{lstlisting}[caption={Send Live Message Test}]
python3 socket_client.py 10.250.113.127 5000
Welcome to Messenger! Please login or create an account:
Create Account
blueberry
Account created. Welcome blueberry!
Send
To: 
cranberry
Message: 
hello there, cranberry.

Message successfully sent.
\end{lstlisting}

\noindent The \texttt{cranberry} client successfully received the message.

\begin{lstlisting}[caption={Receive Live Message Test}]
python3 socket_client.py 10.250.113.127 5000
Welcome to Messenger! Please login or create an account:
Create Account
cranberry
Account created. Welcome cranberry!
<blueberry>: hello there, cranberry.
\end{lstlisting}

\noindent Next we logged out \texttt{blueberry} and sent an outbound message from \texttt{cranberry}. Upon re-logging in \texttt{blueberry} we requested our undelivered messages via \texttt{Open Undelivered Messages} as described in the engineering notebook.

\begin{lstlisting}[caption={Receive Undelivered Message Test}]
python3 socket_client.py 10.250.113.127 5000
Welcome to Messenger! Please login or create an account:
Login 
blueberry
Welcome back blueberry!
Open Undelivered Messages
<cranberry>: Hi, blueberry!
\end{lstlisting}

\noindent The blueberry client successfully received the undelivered message. Sending a message to a non-existent user also correctly returns an error as seen below.

\begin{lstlisting}[caption={Send Message to Nonexistent User Test}]
python3 socket_client.py 10.250.113.127 5000
Welcome to Messenger! Please login or create an account:
Login
blueberry
Welcome back blueberry!
Send
To: 
gooseberry
Message: 
do you exist?
Sorry, message recipient not found. Please try again. 
\end{lstlisting}

\noindent The last remaining functionaity we tested for was deletion, as seen below on the \texttt{blueberry} account.

\begin{lstlisting}[caption={Account Deletion Test}]
python3 socket_client.py 10.250.113.127 5000
Welcome to Messenger! Please login or create an account:
Login
blueberry
Welcome back blueberry!
Delete Account
Account blueberry successfully deleted. 
Welcome to Messenger! Please login or create an account:
\end{lstlisting}

\noindent Thankfully, the gRPC submission command structure follows extremely closely to the non-gRPC one. The only distinction is that no prompt is required to
automatically deliver queued messages on the gRPC implementation. We ran similarly extensive testing on the gRPC implementation and verify that all functionaity is present, but have omitted those tests from this report as they repeat much of what is already present. 

%Example with the corresponding author designated by an asterisk:

%\author{Author One\authormark{1} and Author Two\authormark{2,*}}

%\address{\authormark{1}Peer Review, Publications Department,
%Optica Publishing Group, 2010 Massachusetts Avenue NW,
%Washington, DC 20036, USA\\
%\authormark{2}Publications Department, Optica Publishing Group,
%2010 Massachusetts Avenue NW, Washington, DC 20036, USA\\
%%\authormark{3}xyz@optica.org}

%\email{\authormark{*}opex@optica.org}}

% Example with the corresponding author designated by an asterisk and a note indicating equal contributions by two authors.

%\author{Author One\authormark{1,3} and Author %Two\authormark{2,3,*}}

% \address{\authormark{1}Peer Review, Publications Department,
% Optica Publishing Group, 2010 Massachusetts Avenue NW, %Washington, DC 20036, USA\\
% \authormark{2}Publications Department, Optica Publishing Group, %2010 Massachusetts Avenue NW, Washington, DC 20036, USA\\
% \authormark{3}The authors contributed equally to this work.\\
%\authormark{*}opex@optica.org}}

% \section{Examples of Article Components}
% \label{sec:examples}

\section{Code Rationality, Correctness, and Clarity}
\label{sec:examples}
Artemas: Write some on non-gRPC code Rationality, Correctness, Clarity.

\bigskip

\noindent 

On rationality: Very well thought out design. A lot of effort went into making the code safe, for example limiting message size: 

\begin{lstlisting}[caption={Account Creation Test}]
  # check length requirements
  if len(request.message) > 250 or len(request.receiver) > 50 or len(request.sender) > 50:
    res.status = -1
    return res
\end{lstlisting}

Python dictionaries are concurrency safe. But the project goes above and beyond in handling concurrent requests. If there is extra credit, would flag this project as a contender. 

One note: the design could better leverage the inherent structure of gRPC. The strength of gRPC is the ability to call functions/specify operations on a remote server. Fully leveraging this functionality would simplify the code, by removing some of the work being done on the server. For example, this would make multithreading on the server unnecessary.

On correctness: Create Account and Login functionality are tied together (ie creating an account automatically triggers login). Our implementation was different, but I think theirs is a better design choice. Attempting to list 0 users from the List Account function sometimes fails, but this is fine, because providing more information than asked for isn't problematic. Everything else works as specified. 

On clarity: The provided documentation was comprehensive. The command structure was intuitive. An example of a great explanation:

\textit{To ensure thread safety, we have a lock for every global item, and upon every read or write to that item, we acquire the specific lock until our reads of write are complete for any given thread.} 


\begin{lstlisting}[language=python,caption={use code samples like this}]
def match(query):
message = ''
try:
    for key in client_dictionary.keys():
        match = re.search(query, key)
        if match is not None and match.group() == key:
            message += key + " "
except Exception as e:
    print(e)
    message = 'Regex Error'

return message
\end{lstlisting}

\section{Documentation}

It is not necessary to place figures and tables at the back of the manuscript. Figures and tables should be sized as they are to appear in the final article. Do not include a separate list of figure captions and table titles.


  
\end{document}
